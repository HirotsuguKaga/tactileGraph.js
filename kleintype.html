<html><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script type="text/javascript" src="tactileGraph.js"></script><script type="text/javascript">
var tg = tactileGraphic();

var sp=10;//文字の間隔
var LH=44;//行の高さ
var color="black";//点字の色
var kl00=[[1,3,5,7,9,10,11,13,15,16,17,19,21,23,25],[34,29,24,18,12,24,7,1,7,24,13,18,24,29,34]];
var kl01=[[1,1,1,1,1,1,5,6,6,11,11,12,15,15,15,15],[1,6,12,21,27,34,17,1,34,17,34,1,6,12,22,29]];
var kl02=[[1,1,3,3,7,7,14,14,20,20,23,23],[13,20,7,27,2,33,1,35,2,33,7,28]];
var kl03=[[1,1,1,1,1,1,7,7,12,13,17,18,20,20,20],[1,7,14,21,28,34,1,34,34,1,30,6,12,18,24]];
var kl04=[[1,1,1,1,1,1,7,7,7,13,13,13,19,19],[1,8,15,21,28,35,1,18,35,1,18,35,1,35]];
var kl05=[[1,1,1,1,1,1,6,7,12,12,17],[1,7,14,21,28,34,17,1,1,17,1]];
var kl06=[[1,1,3,4,6,8,13,14,19,20,20,20],[14,20,8,26,3,31,1,33,2,24,28,33]];
var kl07=[[1,1,1,1,1,1,4,10,16,20,20,20,20,20,20],[1,7,13,21,28,34,17,17,17,1,7,13,21,28,34]];
var kl08=[[2,2,2,2,2,2],[1,7,14,21,28,35]];
var kl09=[[1,5,10,16,18,18,18,18,18],[27,31,33,32,1,7,14,21,27]];
var kl10=[[1,1,1,1,1,1,5,8,9,12,13,16,17,21,21],[1,7,14,21,28,35,17,13,21,9,25,5,30,1,35]];
var kl11=[[1,1,1,1,1,1,6,13,19],[1,7,14,20,27,34,34,34,34]];
var kl12=[[1,1,1,1,1,1,5,9,13,16,20,25,25,25,25,25,25],[1,9,16,22,28,34,6,10,14,10,5,1,8,14,20,27,34]];
var kl13=[[1,1,1,1,1,1,6,9,12,15,18,22,22,22,22,22,22],[1,8,15,22,28,35,6,13,19,24,29,1,8,15,22,28,35]];
var kl14=[[1,1,2,2,6,6,11,11,17,17,20,20,21],[15,21,9,28,4,32,1,35,5,31,11,26,19]];
var kl15=[[1,1,1,1,1,1,6,6,12,12,15,15],[1,7,13,20,26,34,1,17,1,17,6,12]];
var kl16=[[1,1,1,1,3,4,10,10,12,15,16,18,18,18,19,24],[9,14,20,25,4,30,1,32,25,29,4,10,16,22,32,32]];
var kl17=[[1,1,1,1,1,1,5,5,10,11,11,13,14,14,15,20],[1,6,12,19,26,34,1,16,16,1,21,26,6,11,31,33]];
var kl18=[[1,3,4,5,5,9,9,12,14,15,15,17,17],[28,9,3,14,32,1,17,33,19,3,29,8,24]];
var kl19=[[1,6,10,14,14,14,14,14,16,22,27],[1,1,1,6,13,20,26,33,1,1,1]];
var kl20=[[1,1,1,1,2,7,13,18,19,19,19,19],[1,7,13,20,26,32,32,26,1,7,13,20]];
var kl21=[[1,3,4,6,8,11,13,15,17,19,21],[1,8,15,21,27,33,27,21,15,8,1]];
var kl22=[[1,3,5,8,10,12,13,15,15,17,18,20,22,23,25,26,27,29,31,33,34,36,37,39],[1,9,15,22,27,1,33,6,27,12,22,17,12,22,6,27,1,33,27,22,16,10,6,1]];
var kl23=[[1,1,4,4,7,7,11,14,14,17,17,20,21],[1,33,6,27,11,22,17,11,22,6,27,1,33]];
var kl24=[[1,4,8,11,11,11,11,15,18,21],[1,7,12,17,22,27,33,12,6,1]];
var kl25=[[1,1,3,6,7,7,9,12,13,13,15,18,19],[1,34,27,21,1,34,16,11,1,34,6,1,34]];
var klp=[[2],[34]];
var klc=[[2,3],[35,34]];
var kle=[[1,1,1,1,1,1],[1,7,13,19,25,34]];
var klhi=[[1,7,13],[17,17,17]];
var def=[[1,1,1,1,1,1,6,6,11,11,16,16,21,21,26,26,26,26,26,26],[6,11,16,21,26,31,6,31,6,31,6,31,6,31,6,11,16,21,26,31]];

var ms00=[[3,7,11,13,13,13,13,14,16,18],[21,19,17,20,24,29,34,14,10,5]];
var ms01=[[3,4,5,7,9,9,11,15,19,23],[29,15,6,29,9,17,26,24,21,16]];
var ms02=[[3,4,5,7,9,10,10,14,15,18,19,19,21,22,23],[29,10,26,21,15,5,10,32,10,30,10,26,21,16,10]];
var ms03=[[2,5,8,10,23,27,29,30],[20,16,13,10,10,13,16,20]];
var ms04=[[4,4,7,7,9,9,11,11,14,16,17,19,21],[15,29,11,27,8,24,3,21,17,14,4,9,5]];
var ms05=[[4,5,9,9,10,12,14,15,15,17,19,19,20],[10,3,10,30,3,26,10,3,22,18,3,14,10]];
var ms06=[[3,4,5,7,7,8,11,15,19,22],[26,11,2,13,25,4,22,20,16,13]];
var ms07=[[1,5,8,9,9,9,9,14,16,18,19,19,19,19,23,28],[15,15,24,5,10,15,19,14,30,24,4,8,14,19,13,12]];
var ms08=[[3,7,12,12,14,17,17,17,20,22,23,26],[7,7,7,15,18,6,15,22,12,5,9,5]];
var ms09=[[3,4,7,8,11,11,12,13,14,15,16,17,17,18,19,20,23,27],[22,14,21,12,3,20,6,10,15,19,24,9,29,34,18,8,17,16]];
var ms10=[[2,7,8,11,12,12,13,15,15,16,16,16,20,24,28],[19,19,10,34,6,18,30,11,26,2,16,21,15,15,15]];
var ms11=[[2,5,8,9,9,9,11,12,13,14,15,15,19,23],[17,14,10,2,6,30,26,10,22,19,9,14,9,8]];
var ms12=[[1,6,9,13,15,16],[24,20,17,13,8,3]];
var ms13=[[2,6,8,11,11,14,16,17,19,20,25,27,28,30],[8,8,31,8,28,23,8,19,14,8,2,5,1,3]];
var ms14=[[2,2,2,2,2,6,9,13,16,19,22,25],[4,8,12,15,20,19,17,15,12,9,5,2]];
var ms15=[[2,5,7,21,24,25,27,30,30,33,33],[20,17,13,11,14,17,20,3,8,5,8]];
var ms16=[[3,4,7,8,10,13,13,15,16,18,18,21],[5,24,20,3,16,2,11,16,7,1,19,22]];
var ms17=[[3,9,11,14,14,17,18,19,21,23,27,29,30,32],[10,10,33,10,29,25,10,20,16,10,5,3,8,6]];
var ms18=[[1,2,4,6,7,10,11,11,15,15,15,15,15,15,15,19],[27,10,24,9,21,17,8,31,3,8,14,19,24,29,34,8]];
var ms19=[[3,3,6,8,9,12,16,19,22,25],[5,25,7,23,9,20,18,16,13,10]];
var ms20=[[2,5,5,8,8,10,11,12,14,15,16,17,18,20,29,31,32,34],[19,15,35,10,32,29,20,26,22,9,18,24,14,9,3,6,1,5]];
var ms21=[[3,4,4,6,9,9,14,14,14,15,15,15,15,19,21,24,25,26,28,31],[17,4,28,13,3,27,2,8,15,21,27,32,38,1,26,1,10,25,15,25]];
var ms22=[[3,4,8,8,11,14,15,18,20,22,27],[20,6,5,19,5,18,4,17,3,16,15]];
var ms23=[[1,3,5,12,14,16,16,17,17,20,20,22,24,25],[15,19,23,2,15,6,10,13,27,11,23,19,14,10]];
var ms24=[[4,6,8,9,11,13,14,16,17,18,20,21,22,22,22,22],[7,32,20,6,31,19,5,31,18,5,31,26,5,10,17,22]];
var ms25=[[1,1,3,4,5,5,6,7,8,9,10,11,11,12,13,14,17,17,19,19],[5,19,16,13,5,9,1,21,5,23,20,5,17,13,9,5,1,2,1,2]];
var ms26=[[1,7,10,11,12,12,13,14,14,15,16,20,21,24,25,27,30],[11,10,1,5,9,15,20,25,29,33,8,7,18,15,6,11,5]];
var ms27=[[1,5,9,9,10,10,10,11,11,11,11,15,15,19,20,24],[1,1,1,5,10,15,20,25,29,33,37,1,14,17,1,1]];
var ms28=[[3,5,6,8,9,11,11,13,15,15,17,18,18,20],[12,7,28,1,25,11,22,18,1,14,9,5,16,1]];
var ms29=[[1,1,2,3,6,10,12,13,13,16,16,18,20,20,21,22,23],[7,11,14,17,10,9,1,4,8,7,27,23,7,19,15,12,7]];

function text(){del();
var keys=document.getElementById('tx').value;
	for (var int = 0; int < keys.length; int++){
	var key=keys.substring(int,int+1);//i番目の文字を描画
switch(key){
case " ":blank();break;
case '　':blank();break;
case 'A':draw(kl00);break;
case 'B':draw(kl01);break;
case 'C':draw(kl02);break;
case 'D':draw(kl03);break;
case 'E':draw(kl04);break;
case 'F':draw(kl05);break;
case 'G':draw(kl06);break;
case 'H':draw(kl07);break;
case 'I':draw(kl08);break;
case 'J':draw(kl09);break;
case 'K':draw(kl10);break;
case 'L':draw(kl11);break;
case 'M':draw(kl12);break;
case 'N':draw(kl13);break;
case 'O':draw(kl14);break;
case 'P':draw(kl15);break;
case 'Q':draw(kl16);break;
case 'R':draw(kl17);break;
case 'S':draw(kl18);break;
case 'T':draw(kl19);break;
case 'U':draw(kl20);break;
case 'V':draw(kl21);break;
case 'W':draw(kl22);break;
case 'X':draw(kl23);break;
case 'Y':draw(kl24);break;
case 'Z':draw(kl25);break;
case '.':draw(klp);break;
case ',':draw(klc);break;
case '!':draw(kle);break;
case '-':draw(klhi);break;
case 'イ':draw(ms00);break;
case 'シ':draw(ms01);break;
case 'カ':draw(ms02);break;
case 'ハ':draw(ms03);break;
case 'ク':draw(ms04);break;
case 'ラ':draw(ms05);break;
case 'シ':draw(ms06);break;
case 'サ':draw(ms07);break;
case 'マ':draw(ms08);break;
case 'キ':draw(ms09);break;
case 'チ':draw(ms10);break;
case 'ケ':draw(ms11);break;
case 'ノ':draw(ms12);break;
case 'ブ':draw(ms13);break;
case 'レ':draw(ms14);break;
case 'バ':draw(ms15);break;
case 'ス':draw(ms16);break;
case 'ブ':draw(ms17);break;
case 'オ':draw(ms18);break;
case 'ン':draw(ms19);break;
case 'ダ':draw(ms20);break;
case '平':draw(ms21);break;
case 'ニ':draw(ms22);break;
case '御':draw(ms23);break;
case 'ヨ':draw(ms24);break;
case 'ガ':draw(ms25);break;
case 'ヤ':draw(ms26);break;
case '下':draw(ms27);break;
case 'タ':draw(ms28);break;
case 'ウ':draw(ms29);break;
case "\n":CR();break;
default:draw(def);break}
	}
}

function del(){
  pos=0;line=0;
  var canvas = document.getElementById('cvs');
  var ctx = canvas.getContext('2d',{alpha: false});
  ctx.fillStyle="white";
  ctx.fillRect(0,0,599,790);
  var canvas2 = document.getElementById('cvs2');
  var ctx2 = canvas2.getContext('2d',{alpha: false});
  ctx2.fillStyle="white";
  ctx2.fillRect(0,0,599,790)
}

function draw(id) {
  var canvas = document.getElementById('cvs');
  var ctx = canvas.getContext('2d');
  var canvas2 = document.getElementById('cvs2');
  var ctx2 = canvas2.getContext('2d');
  var num=Math.max.apply(null, id[0])+sp;
   if(pos+num>600){CR()}//改行チェック
	for (var int = 0; int < id[0].length; int++){
	var x=id[0][int];
	var y=id[1][int];
	ctx.beginPath();
	ctx.fillStyle=color;
	ctx.fillRect(x+pos, y+line,1,1);
	ctx2.beginPath();
	ctx2.fillStyle=color;
	ctx2.fillRect(x+pos, y+line,3,3);
	tg.drawDot(x+pos, y+line); /////////////////////////////////////////////
	}
	
  pos=pos+num;}

function draw2(e){
  var canvas = document.getElementById('cvs');
  var ctx = canvas.getContext('2d',{alpha: false});
  var canvas2 = document.getElementById('cvs2');
  var ctx2 = canvas2.getContext('2d',{alpha: false});
  if(!e)	e = window.event;
var rect = e.target.getBoundingClientRect();
var x=e.clientX- rect.left;
var y=e.clientY- rect.top;
x=x/7;x=Math.floor(x)*7;
y=y/7;y=Math.floor(y)*7;
var img = ctx.getImageData(x,y,1,1);  // 1px by 1px のデータを取得
	if(img.data[2]==255){//img[2] RGBの値で分岐
	ctx.fillStyle=color;
	ctx.fillRect(x,y,1,1);
	ctx2.fillStyle=color;
	ctx2.fillRect(x,y,6,6)}
	else{
	ctx.fillStyle="white";
	ctx.fillRect(x,y,1,1);
	ctx2.fillStyle="white";
	ctx2.fillRect(x,y,6,6)}
}

function blank(){pos=pos+32}//空白
function CR(){pos=0;line=line+LH}//改行

var check=false;
function chgImg(){//キャンバスを画像に変換
  var png=new Image();
   png = cvs.toDataURL();
    document.getElementById("newImg").src=png;
    document.getElementById("downloadImg").href=png;
    document.getElementById("downloadImg").style.display ="inline";
    document.getElementById("CLOSE").style.display ="inline";
}

function close(){
	document.getElementById("downloadImg").style.display ="none";
    document.getElementById("CLOSE").style.display ="none";
}

function space(){var SP=document.getElementById('SP').value;
sp=Number(SP)}

function changeLH(){var lh=document.getElementById('LineHeight').value;
LH=Number(lh)}

function changeColor(){color=document.getElementById('COLOR').value;}

window.onload=del;

</script>
<style type="text/css">
h1{ color: #111;
    font-size: 1.1em;
    font-weight: bold;
    margin: 0 0 0.5em;
    border-bottom: 2px solid #B92A2C;
    box-shadow: 0 1px 0 #aaaaaa;
    -webkit-box-shadow: 0 1px 0 #aaaaaa;
    -moz-box-shadow: 0 1px 0 #aaaaaa;
    text-shadow: #999999 0px 1px 1px;
    font-size:2.0em;}
canvas{border:1px dashed #808080}</style>
<h1>Klein Type Writer</h1>
アルファベット大文字を点描触知文字のKlein Typeに変換するデモです。<br><br>
<a href="javascript:void(0)" download="" id="edl">エーデルファイルをダウンロード</a>　
<a href="javascript:void(0)" download="" id="esa">map2esa用画像をダウンロード</a><br>
<textarea id="tx" cols="19" rows="18" oninput="text()" style="font-size:130%;" placeholder="テキスト入力欄"></textarea>
　文字間隔<textarea id="SP" cols="2" rows="1" oninput="space()">10</textarea>
行の高さ<textarea id="LineHeight" cols="2" rows="1" oninput="changeLH()">44</textarea>
文字色<textarea id="COLOR" cols="10" rows="1" oninput="changeColor()">black</textarea>　
<input onclick="chgImg()" value="点図画像に変換" type="button">
　　<a href="JavaScript:close()" id="CLOSE" style="display:none">点図画像を閉じる</a>
　<a href="" download="Decapoint" id="downloadImg" style="display:none">点図画像をダウンロードする<br>
<img id="newImg"></a>
<canvas id="cvs" width="599" height="790" style="-webkit-backface-visibility: hidden;display:none"></canvas>
<canvas id="cvs2" width="599" height="790" onclick="draw2()" style="-webkit-backface-visibility:hidden"></canvas>
<script>
                  ///////////ダウンロード処理///////////
var filename = "Graph";

var edl = document.querySelector('#edl');
//var png = document.querySelector('#png');
var esa = document.querySelector('#esa');

edl.onclick = function() {
  var blob = new Blob([ tg.loadEdl() ], { "type" : "text/plain" });
  if (window.navigator.msSaveBlob) { 
    window.navigator.msSaveBlob(blob, filename + ".edl"); 
  } else {
    edl.download =  filename + ".edl";  //ダウンロードするファイル名を設定
    edl.href = window.URL.createObjectURL(blob);
  }
}

esa.onclick = function(){
  imgURL = tg.map2esa();
  var bin = atob(imgURL.split(',')[1]);
  var buffer = new Uint8Array(bin.length);
  for (var i = 0; i < bin.length; i++) {
    buffer[i] = bin.charCodeAt(i);
  }
  var blob = new Blob([buffer.buffer], {type: 'image/png'});
  
  if (window.navigator.msSaveBlob) {
  window.navigator.msSaveBlob(blob, filename + '.png'); 
  } else {
    esa.download =  filename + ".png";
    esa.href = window.URL.createObjectURL(blob);
  }
}
</script>
</html>